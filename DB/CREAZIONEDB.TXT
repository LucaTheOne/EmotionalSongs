CREATE TABLE CANZONI (
    REPO_INDEX INT NOT NULL,                                                    
    ID_UNIVOCO VARCHAR(20) PRIMARY KEY,                                                     
    TITOLO VARCHAR NOT NULL,                                                             
    AUTORE VARCHAR NOT NULL,                                                             
    ANNO INT NOT NULL
);

CREATE SEQUENCE SONGS_INDEXES START 0 INCREMENT 1 MINVALUE 0 OWNED BY CANZONI.REPO_INDEX;

CREATE TABLE UTENTI_REGISTRATI(
    ID_USER VARCHAR(20) PRIMARY KEY,
    EMAIL VARCHAR(50) UNIQUE NOT NULL,
    CF VARCHAR(16) UNIQUE NOT NULL,
    PASSWORD VARCHAR(30) NOT NULL,
    NOME VARCHAR(30) NOT NULL,
    COGNOME VARCHAR(30) NOT NULL
);

CREATE TABLE INDIRIZZI (
    RESIDENTE_ID VARCHAR(20) PRIMARY KEY,
    TIPO VARCHAR(11) NOT NULL,
    INDIRIZZO VARCHAR NOT NULL,
    CIVICO INT NOT NULL,
    CAP INT NOT NULL,
    NAZIONE VARCHAR(20) NOT NULL,
    PROVINCIA VARCHAR(20) NOT NULL,
    CITTA VARCHAR(20)NOT NULL
);

ALTER TABLE INDIRIZZI ADD FOREIGN KEY (RESIDENTE_ID) REFERENCES UTENTI_REGISTRATI(ID_USER) ON UPDATE CASCADE ON DELETE CASCADE;

CREATE TABLE PLAYLIST (
    ID_PLAYLIST VARCHAR(20) PRIMARY KEY,
    USER_PROP_ID VARCHAR(20) NOT NULL,
    NOME_PLAYLIST VARCHAR(15) DEFAULT 'NewPlaylist'
);

ALTER TABLE PLAYLIST ADD FOREIGN KEY(USER_PROP_ID) REFERENCES UTENTI_REGISTRATI(ID_USER) ON UPDATE CASCADE ON DELETE CASCADE;

CREATE TABLE CONTENUTO_PLAYLIST(
    PLAYLIST_ID VARCHAR(20),
    CANZONE_ID VARCHAR(20), 
    PRIMARY KEY(PLAYLIST_ID,CANZONE_ID)
);

ALTER TABLE CONTENUTO_PLAYLIST ADD FOREIGN KEY(PLAYLIST_ID) REFERENCES PLAYLIST(ID_PLAYLIST) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE CONTENUTO_PLAYLIST ADD FOREIGN KEY(CANZONE_ID) REFERENCES CANZONI(ID_UNIVOCO) ON DELETE CASCADE ON UPDATE CASCADE;

CREATE TABLE EMOZIONI (
    CANZONE_ID VARCHAR(20),
    USER_PROP_ID VARCHAR(20),
    COMMENTO VARCHAR(256),
    MERAVIGLIA INT CHECK(MERAVIGLIA BETWEEN 1 AND 5) NOT NULL,
    SOLENNITA INT CHECK(SOLENNITA BETWEEN 1 AND 5) NOT NULL,
    TENEREZZA INT CHECK(TENEREZZA BETWEEN 1 AND 5) NOT NULL,
    NOSTALGIA INT CHECK(NOSTALGIA BETWEEN 1 AND 5) NOT NULL,
    PACATEZZA INT CHECK(PACATEZZA BETWEEN 1 AND 5) NOT NULL,
    POTERE INT CHECK(POTERE BETWEEN 1 AND 5) NOT NULL,
    GIOIA INT CHECK(GIOIA BETWEEN 1 AND 5) NOT NULL,
    TENSIONE INT CHECK(TENSIONE BETWEEN 1 AND 5) NOT NULL,
    TRISTEZZA INT CHECK(TRISTEZZA BETWEEN 1 AND 5) NOT NULL
);

ALTER TABLE EMOZIONI ADD PRIMARY KEY(CANZONE_ID,USER_PROP_ID);

ALTER TABLE EMOZIONI ADD FOREIGN KEY(CANZONE_ID) REFERENCES CANZONI(ID_UNIVOCO) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE EMOZIONI ADD FOREIGN KEY(USER_PROP_ID) REFERENCES UTENTI_REGISTRATI(ID_USER) ON DELETE CASCADE ON UPDATE CASCADE;